{"version":3,"file":"SelectMenu.js","names":["React","useState","useEffect","useCallback","PropTypes","classNames","Button","ModalPopup","useToggle","Menu","ExpandMore","SELECT_MENU_DEFAULT_MESSAGE","SelectMenu","defaultMessage","isLink","children","props","triggerTarget","useRef","itemsCollection","useMemo","Array","from","length","map","createRef","className","defaultIndex","i","defaultSelected","undefined","selected","setSelected","isOpen","open","close","vertOffset","setOffset","createMenuItems","elements","Children","child","index","newProps","onClick","e","current","focus","id","toString","role","push","cloneElement","link","prevOpenRef","numItems","boundingRect","parentElement","getBoundingClientRect","bottom","window","innerHeight","top","scrollIntoView","block","preventScroll","createElement","name","enabled","options","offset","offsetWidth","propTypes","string","bool","node","isRequired","defaultProps"],"sources":["../../src/Menu/SelectMenu.jsx"],"sourcesContent":["import React, { useState, useEffect, useCallback } from 'react';\nimport PropTypes from 'prop-types';\nimport classNames from 'classnames';\nimport Button from '../Button/index';\nimport ModalPopup from '../Modal/ModalPopup';\nimport useToggle from '../hooks/useToggle';\nimport Menu from '.';\nimport { ExpandMore } from '../../icons';\n\nexport const SELECT_MENU_DEFAULT_MESSAGE = 'Select...';\n\nconst SelectMenu = ({\n  defaultMessage,\n  isLink,\n  children,\n  ...props\n}) => {\n  const triggerTarget = React.useRef(null);\n  const itemsCollection = React.useMemo(\n    () => Array.from({ length: children.length }).map(() => React.createRef()),\n    [children.length],\n  );\n\n  const className = classNames(props.className, 'pgn__menu-select');\n\n  const defaultIndex = useCallback(() => {\n    for (let i = 0; i < children.length; i++) {\n      if (children[i].props && children[i].props.defaultSelected) {\n        return i;\n      }\n    }\n    return undefined;\n  }, [children]);\n\n  const [selected, setSelected] = useState(defaultIndex());\n  const [isOpen, open, close] = useToggle(false);\n  const [vertOffset, setOffset] = useState(0);\n\n  const createMenuItems = () => {\n    const elements = [];\n    React.Children.map(children, (child, index) => {\n      const newProps = {\n        onClick(e) {\n          if (child.props.onClick) {\n            child.props.onClick(e);\n          }\n          setSelected(index);\n          close();\n          triggerTarget.current.focus();\n        },\n        id: `${index.toString()}_pgn__menu-item`,\n        role: 'link',\n      };\n      if (selected === index) {\n        newProps['aria-current'] = 'page';\n      }\n      elements.push(\n        React.cloneElement(child, newProps),\n      );\n    });\n    return elements;\n  };\n\n  const link = isLink; // allow inline link styling\n  const prevOpenRef = React.useRef();\n\n  useEffect(() => {\n    // logic to always center the selected item.\n    if (isOpen && selected) {\n      const numItems = children.length;\n      const boundingRect = itemsCollection[selected].current.parentElement.getBoundingClientRect();\n      if (boundingRect.bottom >= window.innerHeight - 150 || boundingRect.top <= 150) {\n        setOffset(0); // if too close to the edge, don't do centering fancyness\n      } else {\n        switch (true) {\n          case numItems < 6: {\n            // on small lists, center each element\n            setOffset(\n              (selected) * -48,\n            );\n            break;\n          }\n          case selected < 2: {\n            // On first two elements, set offset based on position\n            setOffset((selected) * -48);\n            break;\n          }\n          case numItems - selected < 3: {\n            // on n-1 and n-2 elelements, set offset to put most modal elements on top.\n            setOffset((6 - (numItems - selected)) * -48);\n            break;\n          }\n          case selected > 1 && numItems - selected > 2: {\n            // on \"middle elements\", set offset to center of block and scroll to center\n            itemsCollection[selected].current.children[0].scrollIntoView({\n              block: 'center',\n            });\n            setOffset(2 * -48);\n            break;\n          }\n          default: break;\n        }\n      }\n    }\n    // set focus on open\n    if (isOpen && !prevOpenRef.current && selected) {\n      itemsCollection[selected].current.children[0].focus({ preventScroll: (defaultIndex() === selected) });\n    }\n    prevOpenRef.current = isOpen;\n  }, [isOpen, children.length, defaultIndex, itemsCollection, selected]);\n\n  return React.createElement(\n    className,\n    {\n      ...props,\n      className,\n    },\n    <>\n      <Button\n        aria-haspopup=\"true\"\n        aria-expanded={isOpen}\n        ref={triggerTarget}\n        className=\"pgn__menu-select-trigger-btn\"\n        variant={link ? 'link' : 'tertiary'}\n        iconAfter={link ? undefined : ExpandMore}\n        onClick={open}\n      >\n        {selected !== undefined && children[selected] ? children[selected].props.children : defaultMessage}\n      </Button>\n      <div className=\"pgn__menu-select-popup\">\n        <ModalPopup\n          placement=\"right-start\"\n          positionRef={triggerTarget}\n          isOpen={isOpen}\n          onClose={close}\n          modifiers={\n            [\n              {\n                name: 'flip',\n                enabled: true,\n              },\n              {\n                name: 'offset',\n                options: {\n                  enabled: true,\n                  offset: [vertOffset, triggerTarget.current ? -1 * triggerTarget.current.offsetWidth : 0],\n                },\n              },\n            ]\n          }\n        >\n          <Menu aria-label=\"Select Menu\">\n            {createMenuItems().map((child, index) => (\n              <div key={child.props.id} ref={itemsCollection[index]}>\n                {child}\n              </div>\n            ))}\n          </Menu>\n        </ModalPopup>\n      </div>\n    </>,\n  );\n};\n\nSelectMenu.propTypes = {\n  /** String that is displayed for default value of the ``SelectMenu`` */\n  defaultMessage: PropTypes.string,\n  /** Displays chosen value of the ``SelectMenu`` as a link */\n  isLink: PropTypes.bool,\n  /** Specifies the content of the ``SelectMenu`` */\n  children: PropTypes.node.isRequired,\n  /** Specifies class name to append to the base element */\n  className: PropTypes.string,\n};\n\nSelectMenu.defaultProps = {\n  defaultMessage: SELECT_MENU_DEFAULT_MESSAGE,\n  isLink: false,\n  className: undefined,\n};\n\nexport default SelectMenu;\n"],"mappings":"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"}