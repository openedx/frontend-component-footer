#!/usr/bin/env node
var deleteSourcemap = require('../index').deleteSourcemap

var yargs = require('yargs')
var argv = yargs
            .usage('$0 --sourcemapId=[ID] --applicationId=[ID] --apiKey=[apiKey]')
            .describe('applicationId', 'Browser application id (APPLICATION_ID)')
            .describe('apiKey', 'New Relic personal user API key (NR_API_KEY)')
            .describe('sourcemapId', 'Source map id')
            .argv

var sourcemapPath = argv._[0]

var options = {
  sourcemapPath: sourcemapPath,
  applicationId: argv.applicationId || process.env.APPLICATION_ID,
  apiKey: argv.apiKey || process.env.NR_API_KEY,
  sourcemapId: argv.sourcemapId || process.env.SOURCEMAP_ID,
  sourcemapUploadHost: argv.sourcemapUploadHost || process.env.SOURCEMAP_UPLOAD_HOST
}

if (!options.apiKey) exitWithError('A New Relic personal user API key is required.')
if (!options.applicationId) exitWithError('A New Relic Browser application ID is required.')
if (!options.sourcemapId) exitWithError('A source map ID is required.')

deleteSourcemap(options, function (err, response) {
  if (err) {
    console.log('Status Code', err.status)
    if (err.response) {
      console.log(err.response.text)
    }
  }
})

function exitWithError (err) {
  yargs.showHelp()
  console.log(err)
  process.exit(1)
}
